<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏õ‡∏•‡∏π‡∏Å‡∏ú‡∏±‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ & ‡∏ï‡∏•‡∏≤‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡πÑ‡∏°‡πâ üöú</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Kanit', 'sans-serif'],
                    },
                    colors: {
                        leaf: { 50: '#f0fdf4', 100: '#dcfce7', 500: '#22c55e', 600: '#16a34a', 700: '#15803d' },
                        market: { 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7' },
                        veg: { 500: '#84cc16', 600: '#65a30d' },
                        bot: { 500: '#8b5cf6', 600: '#7c3aed' }
                    },
                    zIndex: {
                        '60': '60',
                        '70': '70',
                        '80': '80',
                        '90': '90',
                        '100': '100',
                        'modal': '200',
                        'chat': '150',
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f8fafc; overscroll-behavior-y: none; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .tab-active { background-color: white; color: #15803d; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .tab-inactive { color: #4b5563; }
        .market-tab-active { background-color: #0ea5e9; color: white; }
        .market-tab-inactive { background-color: #e0f2fe; color: #0284c7; }
        .modal-tab-active { border-bottom: 2px solid #16a34a; color: #16a34a; font-weight: 600; }
        .modal-tab-inactive { border-bottom: 2px solid transparent; color: #64748b; }
        .chat-msg { max-width: 80%; padding: 10px 14px; border-radius: 16px; font-size: 0.9rem; margin-bottom: 8px; }
        .chat-user { background-color: #7c3aed; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .chat-bot { background-color: #f3f4f6; color: #1f2937; align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid #e5e7eb; }
        .bottom-nav-fixed { z-index: 9999 !important; }
    </style>
</head>
<body class="text-gray-700 pb-28 relative min-h-screen">

    <!-- Navbar -->
    <nav class="bg-leaf-700 text-white p-3 shadow-md sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-lg font-bold flex items-center gap-2">
                <i class="fa-solid fa-seedling text-yellow-300"></i> ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡πÑ‡∏ó‡∏¢
            </h1>
            <div class="flex gap-2">
                <button onclick="openCalculator()" class="bg-white/20 active:bg-white/30 px-3 py-1.5 rounded-lg text-sm transition flex items-center gap-1 hover:bg-white/30">
                    <i class="fa-solid fa-calculator"></i> <span class="hidden sm:inline">‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç</span>
                </button>
                 <button onclick="toggleView('schedule')" class="bg-white/20 active:bg-white/30 px-3 py-1.5 rounded-lg text-sm transition flex items-center gap-1">
                    <i class="fa-solid fa-clipboard-list"></i> ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô (<span id="schedule-count">0</span>)
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-3 py-4 max-w-lg">
        
        <!-- View: Calendar Selection -->
        <div id="calendar-view">
            <!-- Header -->
            <div class="bg-gradient-to-r from-leaf-600 to-leaf-500 rounded-2xl p-5 shadow-lg mb-4 text-white relative overflow-hidden transition-all duration-500" id="season-header-bg">
                <i class="fa-solid fa-cloud-sun text-6xl absolute -right-2 -top-2 opacity-20" id="season-icon-bg"></i>
                <div class="relative z-10">
                    <div class="flex items-center gap-2 mb-1">
                        <i class="fa-regular fa-calendar text-white/80"></i>
                        <input type="date" id="global-date-picker" class="bg-white/20 border-0 rounded px-2 py-0.5 text-sm text-white focus:outline-none focus:ring-2 focus:ring-white/50 cursor-pointer">
                    </div>
                    <h2 class="text-3xl font-bold mt-2 flex items-center gap-3">
                        <span id="current-season-display">...</span>
                        <i class="fa-solid fa-cloud text-2xl opacity-80" id="season-icon-small"></i>
                    </h2>
                    <div id="season-recommendation" class="text-sm mt-3 bg-white/10 rounded-lg p-2 backdrop-blur-sm border border-white/10 leading-relaxed min-h-[40px]"></div>
                    <p class="text-[10px] mt-2 opacity-70"><i class="fa-solid fa-location-dot"></i> ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
                </div>
            </div>

            <!-- Tab Switcher -->
            <div class="bg-gray-100 p-1 rounded-xl flex mb-4 relative z-10">
                <button onclick="switchCategory('fruit')" id="tab-fruit" class="flex-1 py-2 text-sm font-bold rounded-lg transition-all duration-200 flex items-center justify-center gap-2 tab-active">
                    <i class="fa-solid fa-apple-whole"></i> ‡∏ú‡∏•‡πÑ‡∏°‡πâ
                </button>
                <button onclick="switchCategory('veg')" id="tab-veg" class="flex-1 py-2 text-sm font-bold rounded-lg transition-all duration-200 flex items-center justify-center gap-2 tab-inactive">
                    <i class="fa-solid fa-carrot"></i> ‡∏ú‡∏±‡∏Å‡∏™‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡∏ß
                </button>
            </div>

            <!-- Search -->
            <div class="bg-white rounded-xl p-4 shadow-sm mb-4 border border-gray-100 sticky top-[60px] z-40">
                <div class="flex gap-2 mb-3">
                    <div class="relative flex-grow">
                        <i class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        <input type="text" id="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏∑‡∏ä..." class="w-full pl-9 pr-3 py-2 bg-gray-50 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-leaf-500">
                    </div>
                </div>
                <div class="flex items-center justify-between">
                    <p class="text-xs text-gray-500">‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•: <span id="filter-status" class="font-bold text-gray-700">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span></p>
                    <button onclick="filterCurrentMonth()" class="bg-orange-100 text-orange-600 px-3 py-1.5 rounded-full text-xs font-bold shadow-sm hover:bg-orange-200 transition flex items-center gap-1">
                        <i class="fa-solid fa-star"></i> ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ
                    </button>
                </div>
            </div>

            <!-- List -->
            <div class="grid grid-cols-1 gap-3" id="fruit-list"></div>
        </div>

        <!-- View: My Schedule -->
        <div id="schedule-view" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô üå±</h2>
                <button onclick="toggleView('calendar')" class="text-leaf-600 bg-leaf-50 px-3 py-1 rounded-lg text-sm">
                    <i class="fa-solid fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°
                </button>
            </div>
            <div id="schedule-list" class="space-y-3"></div>
            <div id="empty-schedule" class="hidden flex flex-col items-center justify-center py-10 text-gray-400">
                <i class="fa-solid fa-clipboard text-5xl mb-3 opacity-30"></i>
                <p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏π‡∏Å</p>
                <button onclick="toggleView('calendar')" class="mt-4 text-leaf-600 underline text-sm">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏•‡∏¢</button>
            </div>
        </div>

    </div>

    <!-- Floating Chatbot Button -->
    <button onclick="toggleChat()" class="fixed z-50 bottom-28 right-4 md:bottom-8 md:right-8 bg-bot-600 hover:bg-bot-500 text-white p-4 rounded-full shadow-xl transition-transform transform hover:scale-110 active:scale-95 flex items-center justify-center w-14 h-14 border-4 border-white">
        <i class="fa-solid fa-robot text-2xl animate-bounce-slow"></i>
    </button>

    <!-- Chatbot Window -->
    <div id="chatbot-window" class="fixed z-chat bottom-0 right-0 w-full sm:w-[350px] sm:bottom-28 sm:right-4 h-[70vh] sm:h-[500px] bg-white rounded-t-2xl sm:rounded-2xl shadow-2xl flex flex-col transform translate-y-full transition-transform duration-300 border border-gray-200 hidden">
        <div class="bg-bot-600 text-white p-4 rounded-t-2xl flex justify-between items-center shadow-md">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-robot bg-white/20 p-2 rounded-full"></i>
                <div>
                    <h3 class="font-bold text-sm">‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Å‡∏©‡∏ï‡∏£ AI</h3>
                    <p class="text-[10px] text-white/80 flex items-center gap-1"><span class="w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"></span> ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
                </div>
            </div>
            <button onclick="toggleChat()" class="text-white/80 hover:text-white"><i class="fa-solid fa-chevron-down"></i></button>
        </div>
        <div id="chat-messages" class="flex-grow p-4 overflow-y-auto bg-gray-50 flex flex-col gap-2">
            <div class="chat-msg chat-bot">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! üåæ ‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä ‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö</div>
        </div>
        <div class="p-3 bg-white border-t border-gray-100 flex items-center gap-2">
            <input type="text" id="chat-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°..." class="flex-grow bg-gray-100 border-0 rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-bot-500" onkeypress="handleChatEnter(event)">
            <button onclick="sendChatMessage()" class="bg-bot-600 text-white w-10 h-10 rounded-full flex items-center justify-center shadow-sm"><i class="fa-solid fa-paper-plane text-sm"></i></button>
        </div>
    </div>

    <!-- Modal: Planting Calculator & Guide -->
    <div id="calc-modal" class="fixed inset-0 bg-black/60 z-modal hidden flex items-end sm:items-center justify-center backdrop-blur-sm">
        <div class="bg-white w-full sm:w-[450px] sm:rounded-2xl rounded-t-2xl shadow-2xl animate-slide-up flex flex-col max-h-[90vh]">
            <div class="p-4 bg-leaf-50 border-b border-gray-100 rounded-t-2xl flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <span id="modal-icon" class="text-3xl">ü•≠</span>
                    <div>
                        <h3 class="font-bold text-lg text-gray-800" id="modal-title">‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á</h3>
                        <p class="text-xs text-gray-500" id="modal-desc">...</p>
                    </div>
                </div>
                <button onclick="closeCalcModal()" class="w-8 h-8 rounded-full bg-white text-gray-500 shadow-sm flex items-center justify-center"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="flex border-b border-gray-100" id="modal-tabs">
                <button onclick="switchModalTab('timeline')" id="mtab-timeline" class="flex-1 py-3 text-sm font-medium modal-tab-active">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô</button>
                <button onclick="switchModalTab('guide')" id="mtab-guide" class="flex-1 py-3 text-sm font-medium modal-tab-inactive">‡∏ß‡∏¥‡∏ò‡∏µ‡∏î‡∏π‡πÅ‡∏•</button>
            </div>
            <div class="p-5 overflow-y-auto bg-white flex-grow">
                <div id="modal-content-timeline">
                    <div class="mb-6" id="date-input-container">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏•‡∏π‡∏Å (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏î‡∏¥‡∏ô)</label>
                        <input type="date" id="start-date" class="w-full p-3 border border-gray-300 rounded-xl text-lg text-center bg-gray-50">
                    </div>
                    <div class="relative pl-4 border-l-2 border-gray-200 space-y-6">
                        <div class="relative">
                            <div class="absolute -left-[21px] top-1 bg-green-500 w-3 h-3 rounded-full border-2 border-white shadow"></div>
                            <p class="text-xs text-gray-500">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏•‡∏π‡∏Å</p>
                            <p class="font-bold text-gray-800 text-lg" id="preview-start-date">-</p>
                        </div>
                        <div class="relative">
                            <div class="absolute -left-[21px] top-1 bg-yellow-400 w-3 h-3 rounded-full border-2 border-white shadow"></div>
                            <p class="text-xs text-gray-500">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢</p>
                            <p class="font-bold text-yellow-700 text-lg" id="preview-fertilize-date">-</p>
                        </div>
                        <div class="relative">
                            <div class="absolute -left-[21px] top-1 bg-orange-500 w-3 h-3 rounded-full border-2 border-white shadow"></div>
                            <p class="text-xs text-gray-500">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß</p>
                            <p class="font-bold text-orange-700 text-lg" id="preview-harvest-date">-</p>
                        </div>
                    </div>
                </div>
                <div id="modal-content-guide" class="hidden space-y-4">
                    <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                        <h4 class="font-bold text-green-800 mb-2"><i class="fa-solid fa-trowel"></i> ‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏•‡∏π‡∏Å</h4>
                        <p class="text-sm text-gray-700" id="guide-plant">...</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                        <h4 class="font-bold text-blue-800 mb-2"><i class="fa-solid fa-droplet"></i> ‡∏Å‡∏≤‡∏£‡∏£‡∏î‡∏ô‡πâ‡∏≥</h4>
                        <p class="text-sm text-gray-700" id="guide-water">...</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-xl border border-yellow-100">
                        <h4 class="font-bold text-yellow-800 mb-2"><i class="fa-solid fa-poop"></i> ‡∏Å‡∏≤‡∏£‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢</h4>
                        <p class="text-sm text-gray-700" id="guide-fertilizer">...</p>
                    </div>
                </div>
            </div>
            <div class="p-4 border-t border-gray-100 bg-white rounded-b-2xl" id="modal-footer-action">
                <button onclick="saveSchedule()" class="w-full bg-leaf-600 hover:bg-leaf-700 text-white font-bold py-3 rounded-xl shadow-lg transition active:scale-95" id="save-btn">
                    <i class="fa-regular fa-floppy-disk mr-2"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏õ‡∏•‡∏π‡∏Å
                </button>
            </div>
        </div>
    </div>

    <!-- Navigation Bottom Bar -->
    <div class="bottom-nav-fixed fixed bottom-0 left-0 w-full bg-white border-t border-gray-200 flex justify-around py-3 pb-safe z-[100] shadow-[0_-5px_10px_rgba(0,0,0,0.05)] md:hidden">
        <button onclick="toggleView('calendar')" class="flex flex-col items-center gap-1 text-leaf-600">
            <i class="fa-solid fa-calendar-check text-xl"></i>
            <span class="text-[10px]">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏•‡∏π‡∏Å</span>
        </button>
        <button onclick="toggleView('schedule')" class="flex flex-col items-center gap-1 text-gray-400 hover:text-leaf-600" id="nav-schedule">
            <div class="relative">
                <i class="fa-solid fa-list-check text-xl"></i>
                <span id="nav-badge" class="absolute -top-1 -right-2 bg-red-500 text-white text-[9px] w-4 h-4 flex items-center justify-center rounded-full hidden">0</span>
            </div>
            <span class="text-[10px]">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏π‡∏Å</span>
        </button>
        <button onclick="openMarketModal()" class="flex flex-col items-center gap-1 text-gray-400 hover:text-market-600">
            <i class="fa-solid fa-shop text-xl"></i>
            <span class="text-[10px]">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡πÑ‡∏°‡πâ</span>
        </button>
    </div>

    <!-- Market Modal -->
    <div id="market-modal" class="fixed inset-0 bg-black/60 z-modal hidden flex items-center justify-center px-0 sm:px-4 backdrop-blur-sm">
        <div class="bg-white w-full h-full sm:h-[600px] sm:max-w-lg sm:rounded-2xl flex flex-col animate-pop relative overflow-hidden">
            <div class="p-4 bg-market-600 text-white shadow-md z-10">
                <div class="flex justify-between items-center mb-2">
                    <div>
                        <h3 class="text-lg font-bold flex items-center gap-2"><i class="fa-solid fa-money-bill-trend-up"></i> ‡∏ï‡∏•‡∏≤‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡πÑ‡∏°‡πâ</h3>
                        <p class="text-xs text-white/80" id="market-last-update">‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï</p>
                    </div>
                    <button onclick="closeMarketModal()" class="w-8 h-8 rounded-full hover:bg-white/20 flex items-center justify-center"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div class="flex gap-2 mt-2">
                    <button onclick="switchMarketTab('fruit')" id="market-tab-fruit" class="flex-1 py-1.5 text-xs font-bold rounded-lg transition-colors market-tab-active">‡∏ú‡∏•‡πÑ‡∏°‡πâ</button>
                    <button onclick="switchMarketTab('veg')" id="market-tab-veg" class="flex-1 py-1.5 text-xs font-bold rounded-lg transition-colors market-tab-inactive">‡∏ú‡∏±‡∏Å</button>
                </div>
            </div>
            <div class="flex-grow overflow-y-auto bg-slate-50 custom-scrollbar relative">
                <div id="loading-indicator" class="hidden absolute inset-0 bg-white/80 z-20 flex flex-col items-center justify-center text-gray-400">
                    <i class="fa-solid fa-circle-notch text-4xl animate-spin-slow mb-2 text-market-500"></i>
                    <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                </div>
                <table class="w-full market-table bg-white text-left hidden" id="market-table-content">
                    <thead class="sticky top-0 shadow-sm z-10">
                        <tr><th class="w-1/3">‡∏û‡∏∑‡∏ä</th><th>‡∏ï‡πâ‡∏ô<br><span class="text-[10px] font-normal">(‡∏ö./‡∏ï‡πâ‡∏ô)</span></th><th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡∏•<br><span class="text-[10px] font-normal">(‡∏ö./‡∏Å‡∏Å.)</span></th><th class="text-center">‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</th></tr>
                    </thead>
                    <tbody id="market-tbody"></tbody>
                </table>
            </div>
            <div class="p-4 bg-white border-t border-gray-200">
                <button onclick="updateMarketData()" class="w-full bg-market-600 hover:bg-market-700 text-white py-3 rounded-xl shadow-lg flex items-center justify-center gap-2 transition active:scale-95"><i class="fa-solid fa-rotate"></i> ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏Ñ‡∏≤</button>
            </div>
        </div>
    </div>

    <!-- Calculator Modal -->
    <div id="calculator-modal" class="fixed inset-0 bg-black/60 z-modal hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white w-full max-w-xs rounded-2xl shadow-2xl animate-pop overflow-hidden">
            <div class="bg-gray-800 text-white p-3 flex justify-between items-center">
                <h3 class="font-bold"><i class="fa-solid fa-calculator mr-2"></i>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡πÄ‡∏•‡∏Ç</h3>
                <button onclick="closeCalculator()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="bg-gray-100 p-4 border-b border-gray-200">
                <input type="text" id="calc-display" class="w-full bg-transparent text-right text-3xl font-mono outline-none text-gray-800" readonly value="0">
            </div>
            <div class="grid grid-cols-4 gap-1 p-2 bg-gray-50">
                <button onclick="calcClear()" class="col-span-3 bg-red-100 text-red-600 p-3 rounded hover:bg-red-200 font-bold">C</button>
                <button onclick="calcAppend('/')" class="bg-orange-100 text-orange-600 p-3 rounded hover:bg-orange-200 font-bold">√∑</button>
                <button onclick="calcAppend('7')" class="bg-white shadow-sm p-3 rounded hover:bg-gray-100">7</button>
                <button onclick="calcAppend('8')" class="bg-white shadow-sm p-3 rounded hover:bg-gray-100">8</button>
                <button onclick="calcAppend('9')" class="bg-white shadow-sm p-3 rounded hover:bg-gray-100">9</button>
                <button onclick="calcAppend('*')" class="bg-orange-100 text-orange-600 p-3 rounded hover:bg-orange-200 font-bold">√ó</button>
                <button onclick="calcAppend('4')" class="bg-white shadow-sm p-3 rounded hover:bg-gray-100">4</button>
                <button onclick="calcAppend('5')" class="bg-white shadow-sm p-3 rounded hover:bg-gray-100">5</button>
                <button onclick="calcAppend('6')" class="bg-white shadow-sm p-3 rounded hover:bg-gray-100">6</button>
                <button onclick="calcAppend('-')" class="bg-orange-100 text-orange-600 p-3 rounded hover:bg-orange-200 font-bold">-</button>
                <button onclick="calcAppend('1')" class="bg-white shadow-sm p-3 rounded hover:bg-gray-100">1</button>
                <button onclick="calcAppend('2')" class="bg-white shadow-sm p-3 rounded hover:bg-gray-100">2</button>
                <button onclick="calcAppend('3')" class="bg-white shadow-sm p-3 rounded hover:bg-gray-100">3</button>
                <button onclick="calcAppend('+')" class="bg-orange-100 text-orange-600 p-3 rounded hover:bg-orange-200 font-bold">+</button>
                <button onclick="calcAppend('0')" class="col-span-2 bg-white shadow-sm p-3 rounded hover:bg-gray-100">0</button>
                <button onclick="calcAppend('.')" class="bg-white shadow-sm p-3 rounded hover:bg-gray-100">.</button>
                <button onclick="calcEqual()" class="bg-green-500 text-white p-3 rounded hover:bg-green-600 shadow">=</button>
            </div>
        </div>
    </div>

    <script>
        const BACKEND_URL = 'https://mute-heart-d52a.tontakankeawpang.workers.dev/';
        
        const monthNames = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
        const allCrops = [
            { id: 1, type: 'fruit', name: "‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á", icon: "ü•≠", fertilizeDays: 30, harvestDays: 120, months: [0, 1, 2, 3], seedBase: 15, saplingBase: 40 },
            { id: 2, type: 'fruit', name: "‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", icon: "üçà", fertilizeDays: 45, harvestDays: 150, months: [3, 4, 5], seedBase: 200, saplingBase: 250 },
            { id: 3, type: 'fruit', name: "‡∏°‡∏±‡∏á‡∏Ñ‡∏∏‡∏î", icon: "üü£", fertilizeDays: 40, harvestDays: 130, months: [4, 5, 6], seedBase: 10, saplingBase: 80 },
            { id: 4, type: 'fruit', name: "‡πÄ‡∏á‡∏≤‡∏∞", icon: "üî¥", fertilizeDays: 35, harvestDays: 120, months: [4, 5, 6], seedBase: 5, saplingBase: 50 },
            { id: 5, type: 'fruit', name: "‡∏•‡∏≥‡πÑ‡∏¢", icon: "üü§", fertilizeDays: 40, harvestDays: 140, months: [5, 6, 7], seedBase: 10, saplingBase: 60 },
            { id: 6, type: 'fruit', name: "‡∏™‡∏ï‡∏£‡∏≠‡∏ß‡πå‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏£‡∏µ", icon: "üçì", fertilizeDays: 20, harvestDays: 75, months: [9, 10, 11, 0], seedBase: 20, saplingBase: 15 },
            { id: 7, type: 'fruit', name: "‡∏Å‡∏•‡πâ‡∏ß‡∏¢", icon: "üçå", fertilizeDays: 60, harvestDays: 240, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 0, saplingBase: 25 }, 
            { id: 8, type: 'fruit', name: "‡∏°‡∏∞‡∏•‡∏∞‡∏Å‡∏≠", icon: "ü•ì", fertilizeDays: 45, harvestDays: 180, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 50, saplingBase: 15 },
            { id: 9, type: 'fruit', name: "‡∏™‡πâ‡∏°", icon: "üçä", fertilizeDays: 50, harvestDays: 200, months: [8, 9, 10, 11], seedBase: 20, saplingBase: 70 },
            { id: 10, type: 'fruit', name: "‡πÅ‡∏ï‡∏á‡πÇ‡∏°", icon: "üçâ", fertilizeDays: 25, harvestDays: 65, months: [10, 11, 0, 1], seedBase: 45, saplingBase: 10 },
            { id: 11, type: 'fruit', name: "‡∏≠‡∏á‡∏∏‡πà‡∏ô", icon: "üçá", fertilizeDays: 30, harvestDays: 100, months: [10, 11, 0], seedBase: 0, saplingBase: 120 },
            { id: 12, type: 'fruit', name: "‡∏°‡∏∞‡∏û‡∏£‡πâ‡∏≤‡∏ß", icon: "ü••", fertilizeDays: 90, harvestDays: 365, months: [5, 6, 7], seedBase: 50, saplingBase: 80 },
            { id: 13, type: 'fruit', name: "‡∏ù‡∏£‡∏±‡πà‡∏á", icon: "üçè", fertilizeDays: 30, harvestDays: 240, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 10, saplingBase: 40 },
            { id: 14, type: 'fruit', name: "‡∏Ç‡∏ô‡∏∏‡∏ô", icon: "üçà", fertilizeDays: 60, harvestDays: 365, months: [3, 4, 5], seedBase: 15, saplingBase: 60 },
            { id: 15, type: 'fruit', name: "‡∏ô‡πâ‡∏≠‡∏¢‡∏´‡∏ô‡πà‡∏≤", icon: "üçè", fertilizeDays: 45, harvestDays: 150, months: [5, 6, 7], seedBase: 5, saplingBase: 35 },
            { id: 16, type: 'fruit', name: "‡πÅ‡∏Å‡πâ‡∏ß‡∏°‡∏±‡∏á‡∏Å‡∏£", icon: "üê≤", fertilizeDays: 30, harvestDays: 180, months: [4, 5, 6, 7, 8, 9, 10], seedBase: 0, saplingBase: 20 },
            { id: 17, type: 'fruit', name: "‡∏™‡∏±‡∏ö‡∏õ‡∏∞‡∏£‡∏î", icon: "üçç", fertilizeDays: 60, harvestDays: 540, months: [3, 4, 5, 10, 11], seedBase: 0, saplingBase: 10 },
            { id: 18, type: 'fruit', name: "‡∏ä‡∏°‡∏û‡∏π‡πà", icon: "üçé", fertilizeDays: 30, harvestDays: 120, months: [0, 1, 2, 11], seedBase: 10, saplingBase: 80 },
            { id: 19, type: 'fruit', name: "‡∏™‡πâ‡∏°‡πÇ‡∏≠", icon: "üü¢", fertilizeDays: 60, harvestDays: 240, months: [7, 8, 9], seedBase: 20, saplingBase: 150 },
            { id: 20, type: 'fruit', name: "‡∏°‡∏∞‡∏ô‡∏≤‡∏ß", icon: "üçã", fertilizeDays: 30, harvestDays: 150, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 5, saplingBase: 30 },
            { id: 21, type: 'fruit', name: "‡πÄ‡∏™‡∏≤‡∏ß‡∏£‡∏™", icon: "üü£", fertilizeDays: 45, harvestDays: 180, months: [5, 6, 7, 8], seedBase: 10, saplingBase: 25 },
            { id: 22, type: 'fruit', name: "‡∏•‡∏¥‡πâ‡∏ô‡∏à‡∏µ‡πà", icon: "üçí", fertilizeDays: 40, harvestDays: 120, months: [3, 4, 5], seedBase: 15, saplingBase: 80 },
            { id: 23, type: 'fruit', name: "‡∏•‡∏≠‡∏á‡∏Å‡∏≠‡∏á", icon: "üçá", fertilizeDays: 60, harvestDays: 180, months: [7, 8, 9], seedBase: 0, saplingBase: 60 },
            { id: 24, type: 'fruit', name: "‡∏°‡∏∞‡∏¢‡∏á‡∏ä‡∏¥‡∏î", icon: "üü†", fertilizeDays: 45, harvestDays: 100, months: [1, 2, 3], seedBase: 0, saplingBase: 250 },
            { id: 25, type: 'fruit', name: "‡∏•‡∏∞‡∏°‡∏∏‡∏î", icon: "ü•î", fertilizeDays: 40, harvestDays: 200, months: [8, 9, 10, 11], seedBase: 10, saplingBase: 50 },
            { id: 26, type: 'fruit', name: "‡∏Å‡∏£‡∏∞‡∏ó‡πâ‡∏≠‡∏ô", icon: "üçë", fertilizeDays: 50, harvestDays: 150, months: [4, 5, 6], seedBase: 10, saplingBase: 40 },
            { id: 27, type: 'fruit', name: "‡∏û‡∏∏‡∏ó‡∏£‡∏≤", icon: "üü¢", fertilizeDays: 30, harvestDays: 210, months: [7, 8, 9, 10], seedBase: 5, saplingBase: 35 },
            { id: 28, type: 'fruit', name: "‡∏≠‡∏∞‡πÇ‡∏ß‡∏Ñ‡∏≤‡πÇ‡∏î", icon: "ü•ë", fertilizeDays: 60, harvestDays: 300, months: [8, 9, 10, 11], seedBase: 40, saplingBase: 120 },
            { id: 29, type: 'fruit', name: "‡∏ó‡∏±‡∏ö‡∏ó‡∏¥‡∏°", icon: "üî¥", fertilizeDays: 45, harvestDays: 180, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 20, saplingBase: 50 },
            { id: 30, type: 'fruit', name: "‡∏°‡∏∞‡πÄ‡∏ü‡∏∑‡∏≠‡∏á", icon: "‚≠ê", fertilizeDays: 30, harvestDays: 150, months: [5, 6, 7, 8], seedBase: 10, saplingBase: 40 },
            { id: 31, type: 'fruit', name: "‡πÅ‡∏Ñ‡∏ô‡∏ï‡∏≤‡∏•‡∏π‡∏õ", icon: "üçà", fertilizeDays: 25, harvestDays: 75, months: [0, 1, 2, 10, 11], seedBase: 50, saplingBase: 15 },
            { id: 32, type: 'fruit', name: "‡πÄ‡∏°‡∏•‡πà‡∏≠‡∏ô", icon: "üçà", fertilizeDays: 30, harvestDays: 80, months: [0, 1, 2, 9, 10, 11], seedBase: 60, saplingBase: 20 },
            { id: 33, type: 'fruit', name: "‡∏°‡∏∞‡∏Ç‡∏≤‡∏°", icon: "ü•ú", fertilizeDays: 30, harvestDays: 365, months: [5, 6, 7], seedBase: 30, saplingBase: 60 },
            { id: 34, type: 'fruit', name: "‡∏°‡∏∞‡∏Ç‡∏≤‡∏°‡πÄ‡∏ó‡∏®", icon: "ü•®", fertilizeDays: 30, harvestDays: 240, months: [5, 6, 7], seedBase: 20, saplingBase: 40 },
            { id: 35, type: 'fruit', name: "‡∏™‡∏•‡∏∞", icon: "üå∞", fertilizeDays: 60, harvestDays: 730, months: [5, 6, 7], seedBase: 25, saplingBase: 80 },
            { id: 36, type: 'fruit', name: "‡∏£‡∏∞‡∏Å‡∏≥", icon: "üå∞", fertilizeDays: 60, harvestDays: 730, months: [5, 6, 7], seedBase: 20, saplingBase: 70 },
            { id: 37, type: 'fruit', name: "‡∏°‡∏∞‡∏¢‡∏°", icon: "üü°", fertilizeDays: 30, harvestDays: 365, months: [5, 6, 7], seedBase: 10, saplingBase: 30 },
            { id: 38, type: 'fruit', name: "‡∏ï‡∏∞‡∏•‡∏¥‡∏á‡∏õ‡∏•‡∏¥‡∏á", icon: "ü•í", fertilizeDays: 30, harvestDays: 365, months: [5, 6, 7], seedBase: 15, saplingBase: 35 },
            { id: 39, type: 'fruit', name: "‡∏°‡∏∞‡πÑ‡∏ü", icon: "üü°", fertilizeDays: 60, harvestDays: 1095, months: [5, 6, 7], seedBase: 20, saplingBase: 50 },
            { id: 40, type: 'fruit', name: "‡∏°‡∏∞‡∏Å‡∏≠‡∏Å‡∏ô‡πâ‡∏≥", icon: "ü´í", fertilizeDays: 30, harvestDays: 365, months: [5, 6, 7], seedBase: 10, saplingBase: 30 },
            { id: 41, type: 'fruit', name: "‡∏•‡∏π‡∏Å‡∏´‡∏ß‡πâ‡∏≤", icon: "üçá", fertilizeDays: 60, harvestDays: 1825, months: [5, 6, 7], seedBase: 15, saplingBase: 40 },
            { id: 42, type: 'fruit', name: "‡∏ï‡∏∞‡∏Ç‡∏ö", icon: "üçí", fertilizeDays: 30, harvestDays: 180, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 5, saplingBase: 20 },
            { id: 43, type: 'fruit', name: "‡∏≠‡∏¥‡∏ô‡∏ó‡∏ú‡∏•‡∏±‡∏°", icon: "üå¥", fertilizeDays: 60, harvestDays: 1095, months: [5, 6, 7], seedBase: 150, saplingBase: 500 },
            { id: 44, type: 'fruit', name: "‡∏•‡∏π‡∏Å‡∏û‡∏•‡∏±‡∏ö", icon: "üçÖ", fertilizeDays: 60, harvestDays: 1095, months: [9, 10, 11], seedBase: 30, saplingBase: 120 },
            { id: 45, type: 'fruit', name: "‡∏ö‡πä‡∏ß‡∏¢", icon: "üçë", fertilizeDays: 60, harvestDays: 1095, months: [9, 10, 11], seedBase: 30, saplingBase: 100 },
            { id: 46, type: 'fruit', name: "‡∏•‡∏π‡∏Å‡∏ó‡πâ‡∏≠", icon: "üçë", fertilizeDays: 60, harvestDays: 1095, months: [9, 10, 11], seedBase: 30, saplingBase: 100 },
            { id: 47, type: 'fruit', name: "‡∏´‡∏°‡πà‡∏≠‡∏ô", icon: "üçá", fertilizeDays: 30, harvestDays: 120, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 10, saplingBase: 30 },
            { id: 48, type: 'fruit', name: "‡∏°‡∏∞‡∏ï‡∏π‡∏°", icon: "üçê", fertilizeDays: 60, harvestDays: 1825, months: [5, 6, 7], seedBase: 20, saplingBase: 50 },
            { id: 49, type: 'fruit', name: "‡∏™‡πâ‡∏°‡∏à‡∏µ‡πä‡∏î", icon: "üçä", fertilizeDays: 30, harvestDays: 365, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 15, saplingBase: 40 },
            { id: 50, type: 'fruit', name: "‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á‡∏´‡∏≤‡∏ß", icon: "üçí", fertilizeDays: 30, harvestDays: 1095, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 15, saplingBase: 40 },
            { id: 101, type: 'veg', name: "‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î", icon: "üåΩ", fertilizeDays: 20, harvestDays: 70, months: [9, 10, 11, 0, 1], seedBase: 30, saplingBase: 5 },
            { id: 102, type: 'veg', name: "‡∏û‡∏£‡∏¥‡∏Å", icon: "üå∂Ô∏è", fertilizeDays: 30, harvestDays: 90, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 25, saplingBase: 5 },
            { id: 103, type: 'veg', name: "‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®", icon: "üçÖ", fertilizeDays: 25, harvestDays: 60, months: [9, 10, 11, 0], seedBase: 30, saplingBase: 5 },
            { id: 104, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡∏ö‡∏∏‡πâ‡∏á", icon: "üåø", fertilizeDays: 10, harvestDays: 25, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 10, saplingBase: 0 },
            { id: 105, type: 'veg', name: "‡∏Ñ‡∏∞‡∏ô‡πâ‡∏≤", icon: "ü•¨", fertilizeDays: 20, harvestDays: 45, months: [9, 10, 11, 0, 1], seedBase: 15, saplingBase: 2 },
            { id: 106, type: 'veg', name: "‡∏Å‡∏ß‡∏≤‡∏á‡∏ï‡∏∏‡πâ‡∏á", icon: "ü•¨", fertilizeDays: 15, harvestDays: 35, months: [9, 10, 11, 0, 1], seedBase: 15, saplingBase: 2 },
            { id: 107, type: 'veg', name: "‡∏Å‡∏∞‡∏´‡∏•‡πà‡∏≥‡∏õ‡∏•‡∏µ", icon: "ü•ó", fertilizeDays: 30, harvestDays: 90, months: [10, 11, 0], seedBase: 20, saplingBase: 5 },
            { id: 108, type: 'veg', name: "‡∏ñ‡∏±‡πà‡∏ß‡∏ù‡∏±‡∏Å‡∏¢‡∏≤‡∏ß", icon: "ü•í", fertilizeDays: 20, harvestDays: 55, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 20, saplingBase: 0 },
            { id: 109, type: 'veg', name: "‡πÅ‡∏ï‡∏á‡∏Å‡∏ß‡∏≤", icon: "ü•í", fertilizeDays: 15, harvestDays: 35, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 15, saplingBase: 0 },
            { id: 110, type: 'veg', name: "‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏õ‡∏£‡∏≤‡∏∞", icon: "üçÜ", fertilizeDays: 30, harvestDays: 60, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 20, saplingBase: 5 },
            { id: 111, type: 'veg', name: "‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡∏¢‡∏≤‡∏ß", icon: "üçÜ", fertilizeDays: 30, harvestDays: 70, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 20, saplingBase: 5 },
            { id: 112, type: 'veg', name: "‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤", icon: "üçÉ", fertilizeDays: 20, harvestDays: 45, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 10, saplingBase: 10 },
            { id: 113, type: 'veg', name: "‡πÇ‡∏´‡∏£‡∏∞‡∏û‡∏≤", icon: "üçÉ", fertilizeDays: 20, harvestDays: 45, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 10, saplingBase: 10 },
            { id: 114, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡∏ä‡∏µ", icon: "üåø", fertilizeDays: 20, harvestDays: 45, months: [9, 10, 11, 0], seedBase: 30, saplingBase: 0 },
            { id: 115, type: 'veg', name: "‡∏ï‡πâ‡∏ô‡∏´‡∏≠‡∏°", icon: "üå±", fertilizeDays: 20, harvestDays: 45, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 40, saplingBase: 0 },
            { id: 116, type: 'veg', name: "‡∏Ç‡∏∂‡πâ‡∏ô‡∏â‡πà‡∏≤‡∏¢", icon: "üåø", fertilizeDays: 30, harvestDays: 60, months: [9, 10, 11, 0], seedBase: 25, saplingBase: 0 },
            { id: 117, type: 'veg', name: "‡∏ï‡∏∞‡πÑ‡∏Ñ‡∏£‡πâ", icon: "üåæ", fertilizeDays: 45, harvestDays: 120, months: [4, 5, 6], seedBase: 0, saplingBase: 5 },
            { id: 118, type: 'veg', name: "‡∏Ç‡πà‡∏≤", icon: "ü•î", fertilizeDays: 60, harvestDays: 240, months: [4, 5, 6], seedBase: 0, saplingBase: 10 },
            { id: 119, type: 'veg', name: "‡∏ü‡∏±‡∏Å‡∏ó‡∏≠‡∏á", icon: "üéÉ", fertilizeDays: 30, harvestDays: 90, months: [9, 10, 11, 0], seedBase: 20, saplingBase: 5 },
            { id: 120, type: 'veg', name: "‡∏ü‡∏±‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", icon: "üçà", fertilizeDays: 30, harvestDays: 70, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 15, saplingBase: 5 },
            { id: 121, type: 'veg', name: "‡∏ö‡∏ß‡∏ö", icon: "ü•í", fertilizeDays: 20, harvestDays: 50, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 15, saplingBase: 0 },
            { id: 122, type: 'veg', name: "‡∏°‡∏∞‡∏£‡∏∞", icon: "ü•í", fertilizeDays: 25, harvestDays: 60, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 20, saplingBase: 5 },
            { id: 123, type: 'veg', name: "‡∏ï‡∏≥‡∏•‡∏∂‡∏á", icon: "üçÉ", fertilizeDays: 30, harvestDays: 60, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 10, saplingBase: 5 },
            { id: 124, type: 'veg', name: "‡∏ä‡∏∞‡∏≠‡∏°", icon: "üåø", fertilizeDays: 30, harvestDays: 90, months: [4, 5, 6], seedBase: 10, saplingBase: 15 },
            { id: 125, type: 'veg', name: "‡∏Å‡∏£‡∏∞‡πÄ‡∏à‡∏µ‡πä‡∏¢‡∏ö‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", icon: "üå∂Ô∏è", fertilizeDays: 25, harvestDays: 55, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 15, saplingBase: 0 },
            { id: 126, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î‡∏´‡∏≠‡∏°", icon: "ü•ó", fertilizeDays: 20, harvestDays: 45, months: [9, 10, 11, 0, 1], seedBase: 20, saplingBase: 2 },
            { id: 127, type: 'veg', name: "‡∏ö‡∏£‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏•‡∏µ", icon: "ü•¶", fertilizeDays: 30, harvestDays: 75, months: [10, 11, 0], seedBase: 40, saplingBase: 5 },
            { id: 128, type: 'veg', name: "‡∏Å‡∏∞‡∏´‡∏•‡πà‡∏≥‡∏î‡∏≠‡∏Å", icon: "ü•¶", fertilizeDays: 30, harvestDays: 80, months: [10, 11, 0], seedBase: 35, saplingBase: 5 },
            { id: 129, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡πÇ‡∏Ç‡∏°", icon: "üçÉ", fertilizeDays: 15, harvestDays: 35, months: [9, 10, 11, 0, 1], seedBase: 15, saplingBase: 0 },
            { id: 130, type: 'veg', name: "‡∏´‡∏ô‡πà‡∏≠‡πÑ‡∏°‡πâ‡∏ù‡∏£‡∏±‡πà‡∏á", icon: "üéã", fertilizeDays: 90, harvestDays: 240, months: [0, 1, 10, 11], seedBase: 50, saplingBase: 20 },
            { id: 131, type: 'veg', name: "‡πÅ‡∏Ñ‡∏£‡∏≠‡∏ó", icon: "ü•ï", fertilizeDays: 30, harvestDays: 90, months: [10, 11, 0], seedBase: 25, saplingBase: 0 },
            { id: 132, type: 'veg', name: "‡∏´‡∏±‡∏ß‡πÑ‡∏ä‡πÄ‡∏ó‡πâ‡∏≤", icon: "üêá", fertilizeDays: 20, harvestDays: 50, months: [10, 11, 0], seedBase: 15, saplingBase: 0 },
            { id: 133, type: 'veg', name: "‡∏´‡∏≠‡∏°‡πÅ‡∏î‡∏á", icon: "üßÖ", fertilizeDays: 30, harvestDays: 70, months: [10, 11, 0], seedBase: 40, saplingBase: 0 },
            { id: 134, type: 'veg', name: "‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°", icon: "üßÑ", fertilizeDays: 30, harvestDays: 100, months: [10, 11, 0], seedBase: 50, saplingBase: 0 },
            { id: 135, type: 'veg', name: "‡∏Ç‡∏¥‡∏á", icon: "üç†", fertilizeDays: 60, harvestDays: 240, months: [3, 4, 5], seedBase: 30, saplingBase: 0 },
            { id: 136, type: 'veg', name: "‡∏Ç‡∏°‡∏¥‡πâ‡∏ô", icon: "üü®", fertilizeDays: 60, harvestDays: 240, months: [4, 5, 6], seedBase: 20, saplingBase: 0 },
            { id: 137, type: 'veg', name: "‡∏Å‡∏£‡∏∞‡∏ä‡∏≤‡∏¢", icon: "ü•î", fertilizeDays: 60, harvestDays: 240, months: [4, 5, 6], seedBase: 20, saplingBase: 0 },
            { id: 138, type: 'veg', name: "‡∏°‡∏∞‡∏Å‡∏£‡∏π‡∏î", icon: "üçã", fertilizeDays: 90, harvestDays: 365, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 20, saplingBase: 50 },
            { id: 139, type: 'veg', name: "‡∏™‡∏∞‡∏£‡∏∞‡πÅ‡∏´‡∏ô‡πà", icon: "üåø", fertilizeDays: 15, harvestDays: 45, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 0, saplingBase: 10 },
            { id: 140, type: 'veg', name: "‡∏°‡∏±‡∏ô‡πÄ‡∏ó‡∏®", icon: "üç†", fertilizeDays: 30, harvestDays: 100, months: [9, 10, 11, 0, 1], seedBase: 10, saplingBase: 5 },
            { id: 141, type: 'veg', name: "‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å", icon: "ü•î", fertilizeDays: 60, harvestDays: 200, months: [4, 5, 6], seedBase: 20, saplingBase: 10 },
            { id: 142, type: 'veg', name: "‡∏ñ‡∏±‡πà‡∏ß‡∏û‡∏π", icon: "ü•í", fertilizeDays: 30, harvestDays: 90, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 15, saplingBase: 0 },
            { id: 143, type: 'veg', name: "‡∏ñ‡∏±‡πà‡∏ß‡∏•‡∏¥‡∏™‡∏á", icon: "ü•ú", fertilizeDays: 30, harvestDays: 100, months: [0, 1, 5, 6, 9, 10], seedBase: 25, saplingBase: 0 },
            { id: 144, type: 'veg', name: "‡∏ô‡πâ‡∏≥‡πÄ‡∏ï‡πâ‡∏≤", icon: "üçê", fertilizeDays: 30, harvestDays: 70, months: [9, 10, 11, 0], seedBase: 15, saplingBase: 5 },
            { id: 145, type: 'veg', name: "‡∏î‡∏≠‡∏Å‡πÅ‡∏Ñ", icon: "üåº", fertilizeDays: 60, harvestDays: 120, months: [5, 6, 7], seedBase: 10, saplingBase: 20 },
            { id: 146, type: 'veg', name: "‡∏™‡∏∞‡πÄ‡∏î‡∏≤", icon: "üåø", fertilizeDays: 90, harvestDays: 365, months: [5, 6, 7], seedBase: 15, saplingBase: 40 },
            { id: 147, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡∏Å‡∏£‡∏∞‡πÄ‡∏â‡∏î", icon: "üåø", fertilizeDays: 15, harvestDays: 40, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 0, saplingBase: 10 },
            { id: 148, type: 'veg', name: "‡∏Å‡∏∏‡∏¢‡∏ä‡πà‡∏≤‡∏¢", icon: "ü•¨", fertilizeDays: 30, harvestDays: 90, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 20, saplingBase: 5 },
            { id: 149, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡∏ä‡∏µ‡∏ù‡∏£‡∏±‡πà‡∏á", icon: "üåø", fertilizeDays: 30, harvestDays: 90, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 25, saplingBase: 5 },
            { id: 150, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡∏ä‡∏µ‡∏•‡∏≤‡∏ß", icon: "üåø", fertilizeDays: 20, harvestDays: 50, months: [9, 10, 11, 0], seedBase: 20, saplingBase: 0 },
            { id: 151, type: 'veg', name: "‡πÅ‡∏°‡∏á‡∏•‡∏±‡∏Å", icon: "üçÉ", fertilizeDays: 20, harvestDays: 50, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 10, saplingBase: 0 },
            { id: 152, type: 'veg', name: "‡πÉ‡∏ö‡∏ö‡∏±‡∏ß‡∏ö‡∏Å", icon: "üçÄ", fertilizeDays: 20, harvestDays: 60, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 0, saplingBase: 10 },
            { id: 153, type: 'veg', name: "‡πÄ‡∏ï‡∏¢‡∏´‡∏≠‡∏°", icon: "üåø", fertilizeDays: 60, harvestDays: 180, months: [5, 6, 7], seedBase: 0, saplingBase: 15 },
            { id: 154, type: 'veg', name: "‡∏Å‡∏£‡∏∞‡πÄ‡∏à‡∏µ‡πä‡∏¢‡∏ö‡πÅ‡∏î‡∏á", icon: "üå∫", fertilizeDays: 30, harvestDays: 120, months: [8, 9, 10], seedBase: 10, saplingBase: 0 },
            { id: 155, type: 'veg', name: "‡∏≠‡∏±‡∏ç‡∏ä‡∏±‡∏ô", icon: "üå∏", fertilizeDays: 30, harvestDays: 90, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 10, saplingBase: 15 },
            { id: 156, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î‡∏Ç‡∏≤‡∏ß", icon: "ü•¨", fertilizeDays: 20, harvestDays: 50, months: [10, 11, 0, 1], seedBase: 20, saplingBase: 0 },
            { id: 157, type: 'veg', name: "‡∏Å‡∏ß‡∏≤‡∏á‡∏ï‡∏∏‡πâ‡∏á‡∏Æ‡πà‡∏≠‡∏á‡πÄ‡∏ï‡πâ", icon: "ü•¨", fertilizeDays: 20, harvestDays: 45, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 20, saplingBase: 0 },
            { id: 158, type: 'veg', name: "‡∏Å‡∏£‡∏µ‡∏ô‡πÇ‡∏≠‡πä‡∏Ñ", icon: "ü•ó", fertilizeDays: 20, harvestDays: 45, months: [10, 11, 0, 1], seedBase: 25, saplingBase: 5 },
            { id: 159, type: 'veg', name: "‡πÄ‡∏£‡∏î‡πÇ‡∏≠‡πä‡∏Ñ", icon: "ü•ó", fertilizeDays: 20, harvestDays: 45, months: [10, 11, 0, 1], seedBase: 25, saplingBase: 5 },
            { id: 160, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡∏Ñ‡∏≠‡∏™", icon: "ü•ó", fertilizeDays: 20, harvestDays: 45, months: [10, 11, 0, 1], seedBase: 25, saplingBase: 5 },
            { id: 161, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡∏õ‡∏•‡∏±‡∏á", icon: "üåø", fertilizeDays: 20, harvestDays: 50, months: [5, 6, 7], seedBase: 10, saplingBase: 5 },
            { id: 162, type: 'veg', name: "‡∏ü‡∏±‡∏Å‡∏Ç‡πâ‡∏≤‡∏ß", icon: "üü†", fertilizeDays: 60, harvestDays: 240, months: [5, 6, 7], seedBase: 20, saplingBase: 50 },
            { id: 163, type: 'veg', name: "‡∏ö‡∏ß‡∏ö‡∏á‡∏π", icon: "üêç", fertilizeDays: 30, harvestDays: 60, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 15, saplingBase: 0 },
            { id: 164, type: 'veg', name: "‡∏ñ‡∏±‡πà‡∏ß‡∏•‡∏±‡∏ô‡πÄ‡∏ï‡∏≤", icon: "ü•ú", fertilizeDays: 30, harvestDays: 70, months: [10, 11, 0], seedBase: 30, saplingBase: 0 },
            { id: 165, type: 'veg', name: "‡∏´‡∏≠‡∏°‡∏´‡∏±‡∏ß‡πÉ‡∏´‡∏ç‡πà", icon: "üßÖ", fertilizeDays: 40, harvestDays: 120, months: [10, 11, 0], seedBase: 50, saplingBase: 0 },
            { id: 166, type: 'veg', name: "‡∏°‡∏±‡∏ô‡∏ù‡∏£‡∏±‡πà‡∏á", icon: "ü•î", fertilizeDays: 40, harvestDays: 100, months: [10, 11, 0], seedBase: 30, saplingBase: 0 },
            { id: 167, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡∏´‡∏ß‡∏≤‡∏ô‡∏õ‡πà‡∏≤", icon: "üåø", fertilizeDays: 120, harvestDays: 730, months: [5, 6], seedBase: 50, saplingBase: 100 },
            { id: 168, type: 'veg', name: "‡∏ú‡∏±‡∏Å‡∏Å‡∏π‡∏î", icon: "üåø", fertilizeDays: 30, harvestDays: 90, months: [5, 6, 7, 8], seedBase: 0, saplingBase: 20 },
            { id: 169, type: 'veg', name: "‡∏¢‡∏µ‡πà‡∏´‡∏£‡πà‡∏≤", icon: "üçÉ", fertilizeDays: 30, harvestDays: 70, months: [0,1,2,3,4,5,6,7,8,9,10,11], seedBase: 15, saplingBase: 10 },
            { id: 170, type: 'veg', name: "‡∏û‡∏£‡∏¥‡∏Å‡πÑ‡∏ó‡∏¢", icon: "‚ö´", fertilizeDays: 90, harvestDays: 365, months: [5, 6, 7], seedBase: 0, saplingBase: 50 }
        ];

        let currentSelectedDate = new Date();
        let currentMonthIndex = currentSelectedDate.getMonth();
        let currentCategory = 'fruit';
        let currentMarketCategory = 'fruit';
        let currentPlanting = null; 
        let mySchedules = JSON.parse(localStorage.getItem('myPlantingSchedule')) || [];

        function toggleView(view) {
            document.getElementById('calendar-view').classList.add('hidden');
            document.getElementById('schedule-view').classList.add('hidden');
            document.getElementById('nav-schedule').classList.remove('text-leaf-600');
            if(view === 'schedule') {
                document.getElementById('schedule-view').classList.remove('hidden');
                document.getElementById('nav-schedule').classList.add('text-leaf-600');
            } else {
                document.getElementById('calendar-view').classList.remove('hidden');
            }
        }
        function formatDate(date) { return date.toLocaleDateString('th-TH', { day: 'numeric', month: 'long', year: 'numeric' }); }
        function formatDateShort(date) { return date.toLocaleDateString('th-TH', { day: 'numeric', month: 'short' }); }
        function getSeasonalRecommendations(monthIndex) {
            const suitableFruits = allCrops.filter(c => c.type === 'fruit' && c.months.includes(monthIndex));
            const suitableVegs = allCrops.filter(c => c.type === 'veg' && c.months.includes(monthIndex));
            const selectedFruits = suitableFruits.slice(0, 2).map(c => c.name);
            const selectedVegs = suitableVegs.slice(0, 2).map(c => c.name);
            let recText = "";
            if (selectedFruits.length > 0) recText += `üçì ‡∏ú‡∏•‡πÑ‡∏°‡πâ: ${selectedFruits.join(', ')} `;
            if (selectedVegs.length > 0) recText += `ü•¶ ‡∏ú‡∏±‡∏Å: ${selectedVegs.join(', ')}`;
            return recText || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏∑‡∏ä‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©";
        }
        function updateHeaderAndSeason() {
            const month = currentSelectedDate.getMonth();
            let season = "‡∏§‡∏î‡∏π‡∏£‡πâ‡∏≠‡∏ô";
            let icon = "fa-sun";
            let gradientClass = "from-orange-500 to-red-500";
            if (month >= 4 && month <= 9) { 
                season = "‡∏§‡∏î‡∏π‡∏ù‡∏ô"; 
                icon = "fa-cloud-showers-heavy";
                gradientClass = "from-blue-500 to-teal-500";
            } else if (month >= 10 || month <= 1) { 
                season = "‡∏§‡∏î‡∏π‡∏´‡∏ô‡∏≤‡∏ß"; 
                icon = "fa-snowflake";
                gradientClass = "from-indigo-500 to-purple-500";
            }
            const seasonDisplay = document.getElementById('current-season-display');
            if (seasonDisplay) seasonDisplay.innerText = season;
            const recDisplay = document.getElementById('season-recommendation');
            if (recDisplay) recDisplay.innerText = getSeasonalRecommendations(month);
            const smallIcon = document.getElementById('season-icon-small');
            if (smallIcon) smallIcon.className = `fa-solid ${icon} text-2xl opacity-80`;
            const bgIcon = document.getElementById('season-icon-bg');
            if (bgIcon) bgIcon.className = `fa-solid ${icon} text-6xl absolute -right-2 -top-2 opacity-20`;
            const headerBg = document.getElementById('season-header-bg');
            if (headerBg) headerBg.className = `rounded-2xl p-5 shadow-lg mb-4 text-white relative overflow-hidden transition-all duration-500 bg-gradient-to-r ${gradientClass}`;
        }
        function renderCrops() {
            const container = document.getElementById('fruit-list');
            if (!container) return;
            container.innerHTML = '';
            const searchInput = document.getElementById('search-input');
            const searchText = searchInput ? searchInput.value.toLowerCase() : '';
            const list = allCrops.filter(c => c.type === currentCategory && c.name.toLowerCase().includes(searchText));
            if(list.length === 0) {
                container.innerHTML = `<div class="p-8 text-center text-gray-400 bg-white rounded-xl border border-dashed"><i class="fa-solid fa-leaf text-3xl mb-2"></i><br>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>`;
                return;
            }
            list.forEach(crop => {
                const isRecommended = crop.months.includes(currentMonthIndex);
                const recommendBadge = isRecommended ? `<span class="bg-orange-100 text-orange-600 text-[10px] px-1.5 py-0.5 rounded ml-2">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>` : '';
                const iconBg = crop.type === 'fruit' ? 'bg-leaf-50' : 'bg-lime-50';
                const btnColor = crop.type === 'fruit' ? 'bg-leaf-500' : 'bg-veg-600';
                const item = document.createElement('div');
                item.className = 'bg-white p-3 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between active:scale-[0.98] transition cursor-pointer';
                item.onclick = () => openCalcModal(crop);
                item.innerHTML = `<div class="flex items-center gap-3"><div class="w-12 h-12 ${iconBg} rounded-full flex items-center justify-center text-2xl">${crop.icon}</div><div><h4 class="font-bold text-gray-800 flex items-center">${crop.name} ${recommendBadge}</h4><p class="text-xs text-gray-500">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß: ${crop.harvestDays} ‡∏ß‡∏±‡∏ô</p></div></div><button class="${btnColor} text-white w-8 h-8 rounded-full shadow-sm flex items-center justify-center"><i class="fa-solid fa-plus"></i></button>`;
                container.appendChild(item);
            });
        }
        function switchCategory(type) {
            currentCategory = type;
            const btnFruit = document.getElementById('tab-fruit');
            const btnVeg = document.getElementById('tab-veg');
            if (btnFruit && btnVeg) {
                if(type === 'fruit') {
                    btnFruit.className = 'flex-1 py-2 text-sm font-bold rounded-lg transition-all flex items-center justify-center gap-2 tab-active';
                    btnVeg.className = 'flex-1 py-2 text-sm font-bold rounded-lg transition-all flex items-center justify-center gap-2 tab-inactive';
                } else {
                    btnVeg.className = 'flex-1 py-2 text-sm font-bold rounded-lg transition-all flex items-center justify-center gap-2 tab-active';
                    btnFruit.className = 'flex-1 py-2 text-sm font-bold rounded-lg transition-all flex items-center justify-center gap-2 tab-inactive';
                }
            }
            const searchInput = document.getElementById('search-input');
            if (searchInput) searchInput.value = "";
            const filterStatus = document.getElementById('filter-status');
            if (filterStatus) filterStatus.innerText = "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î";
            renderCrops();
        }
        function filterCurrentMonth() {
            const container = document.getElementById('fruit-list');
            if (!container) return;
            container.innerHTML = '';
            const list = allCrops.filter(c => c.type === currentCategory && c.months.includes(currentMonthIndex));
            if(list.length === 0) {
                container.innerHTML = `<div class="p-8 text-center text-gray-400 bg-white rounded-xl border border-dashed">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏û‡∏∑‡∏ä‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>`;
                return;
            }
            list.forEach(crop => {
                const iconBg = crop.type === 'fruit' ? 'bg-leaf-50' : 'bg-lime-50';
                const btnColor = crop.type === 'fruit' ? 'bg-leaf-500' : 'bg-veg-600';
                const item = document.createElement('div');
                item.className = 'bg-white p-3 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between active:scale-[0.98] transition cursor-pointer';
                item.onclick = () => openCalcModal(crop);
                item.innerHTML = `<div class="flex items-center gap-3"><div class="w-12 h-12 ${iconBg} rounded-full flex items-center justify-center text-2xl">${crop.icon}</div><div><h4 class="font-bold text-gray-800 flex items-center">${crop.name} <span class="bg-orange-100 text-orange-600 text-[10px] px-1.5 py-0.5 rounded ml-2">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span></h4><p class="text-xs text-gray-500">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß: ${crop.harvestDays} ‡∏ß‡∏±‡∏ô</p></div></div><button class="${btnColor} text-white w-8 h-8 rounded-full shadow-sm flex items-center justify-center"><i class="fa-solid fa-plus"></i></button>`;
                container.appendChild(item);
            });
            const filterStatus = document.getElementById('filter-status');
            if (filterStatus) filterStatus.innerText = `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${monthNames[currentMonthIndex]}`;
        }
        function renderScheduleList() {
            const list = document.getElementById('schedule-list');
            const emptyState = document.getElementById('empty-schedule');
            const countBadges = document.querySelectorAll('#schedule-count, #nav-badge');
            if (countBadges) {
                countBadges.forEach(el => {
                    el.innerText = mySchedules.length;
                    if(el.id === 'nav-badge') el.classList.toggle('hidden', mySchedules.length === 0);
                });
            }
            if (!list || !emptyState) return;
            if(mySchedules.length === 0) {
                list.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            emptyState.classList.add('hidden');
            list.innerHTML = '';
            mySchedules.forEach(item => {
                const start = new Date(item.startDate);
                const fertilize = new Date(item.fertilizeDate);
                const harvest = new Date(item.harvestDate);
                const hasImage = item.image && item.image.length > 0;
                const imageDisplay = hasImage ? `<img src="${item.image}" class="w-full h-full object-cover" alt="${item.name}">` : `<div class="w-full h-full flex items-center justify-center text-4xl bg-gray-100 text-gray-400">${item.icon}</div>`;
                const div = document.createElement('div');
                div.className = 'bg-white rounded-xl shadow-sm border border-gray-100 relative overflow-hidden group hover:shadow-md transition-all';
                div.innerHTML = `<div class="flex p-4 gap-4"><div class="w-24 h-24 rounded-lg overflow-hidden flex-shrink-0 relative cursor-pointer border border-gray-200 group-image" onclick="triggerUpload(event, ${item.id})">${imageDisplay}<div class="absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"><i class="fa-solid fa-camera text-white"></i></div><input type="file" id="file-${item.id}" class="hidden" accept="image/*" onchange="handleImageUpload(event, ${item.id})"></div><div class="flex-grow cursor-pointer" onclick="openScheduleDetails(${item.id})"><div class="flex justify-between items-start mb-1"><h3 class="font-bold text-gray-800 text-lg">${item.name}</h3></div><div class="grid grid-cols-3 gap-1 text-center text-[10px] mt-2"><div class="bg-gray-50 rounded p-1"><div class="text-gray-500">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏õ‡∏•‡∏π‡∏Å</div><div class="font-semibold text-gray-700">${formatDateShort(start)}</div></div><div class="bg-yellow-50 rounded p-1 border border-yellow-100"><div class="text-yellow-600">‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢</div><div class="font-semibold text-yellow-700">${formatDateShort(fertilize)}</div></div><div class="bg-orange-50 rounded p-1 border border-orange-100"><div class="text-orange-600">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß</div><div class="font-semibold text-orange-700">${formatDateShort(harvest)}</div></div></div></div></div><button onclick="deleteSchedule(event, ${item.id})" class="absolute top-2 right-2 w-8 h-8 bg-white hover:bg-red-50 text-gray-400 hover:text-red-500 rounded-full shadow-sm flex items-center justify-center transition-all border border-gray-100 z-10"><i class="fa-solid fa-trash-can text-sm"></i></button>`;
                list.appendChild(div);
            });
        }
        function triggerUpload(event, id) {
            event.stopPropagation();
            const el = document.getElementById(`file-${id}`);
            if (el) el.click();
        }
        function handleImageUpload(event, id) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const MAX_WIDTH = 300; 
                    const MAX_HEIGHT = 300;
                    let width = img.width;
                    let height = img.height;
                    if (width > height) { if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; } } else { if (height > MAX_HEIGHT) { width *= MAX_HEIGHT / height; height = MAX_HEIGHT; } }
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    const dataUrl = canvas.toDataURL('image/jpeg', 0.5);
                    const index = mySchedules.findIndex(item => item.id === id);
                    if (index !== -1) {
                        mySchedules[index].image = dataUrl;
                        try {
                            localStorage.setItem('myPlantingSchedule', JSON.stringify(mySchedules));
                            renderScheduleList();
                        } catch (err) {
                            alert("‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏û‡∏≠");
                        }
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        function deleteSchedule(event, id) {
            event.stopPropagation();
            if(confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? üóëÔ∏è')) {
                mySchedules = mySchedules.filter(item => item.id !== id);
                localStorage.setItem('myPlantingSchedule', JSON.stringify(mySchedules));
                renderScheduleList();
            }
        }
        function openCalcModal(crop, existingDate = null) {
            currentPlanting = crop;
            document.getElementById('modal-icon').innerText = crop.icon;
            document.getElementById('modal-title').innerText = crop.name;
            document.getElementById('modal-desc').innerText = `‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß: ~${crop.harvestDays} ‡∏ß‡∏±‡∏ô`;
            let careText = "‡∏£‡∏î‡∏ô‡πâ‡∏≥‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢‡∏ó‡∏∏‡∏Å 15-30 ‡∏ß‡∏±‡∏ô"; 
            if (crop.type === 'fruit') careText = "‡∏£‡∏∞‡∏¢‡∏∞‡πÅ‡∏£‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡πâ‡∏≥‡∏°‡∏≤‡∏Å ‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢‡∏õ‡∏µ‡∏•‡∏∞ 2-3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
            else careText = "‡∏£‡∏î‡∏ô‡πâ‡∏≥‡πÄ‡∏ä‡πâ‡∏≤-‡πÄ‡∏¢‡πá‡∏ô ‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢‡∏Ñ‡∏≠‡∏Å‡∏£‡∏≠‡∏á‡∏Å‡πâ‡∏ô‡∏´‡∏•‡∏∏‡∏°";
            document.getElementById('guide-plant').innerText = "‡∏Ç‡∏∏‡∏î‡∏´‡∏•‡∏∏‡∏°‡∏û‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ‡∏£‡∏≠‡∏á‡∏Å‡πâ‡∏ô‡∏´‡∏•‡∏∏‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πã‡∏¢‡∏´‡∏°‡∏±‡∏Å";
            document.getElementById('guide-water').innerText = "‡∏£‡∏î‡∏ô‡πâ‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡∏∏‡πà‡∏°‡πÅ‡∏ï‡πà‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÅ‡∏â‡∏∞";
            document.getElementById('guide-fertilizer').innerText = "‡πÉ‡∏™‡πà‡∏õ‡∏∏‡πã‡∏¢‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏™‡∏°‡∏≠‡∏ó‡∏∏‡∏Å 15-20 ‡∏ß‡∏±‡∏ô";
            const dateInput = document.getElementById('start-date');
            if (existingDate) {
                dateInput.valueAsDate = existingDate;
                document.getElementById('date-input-container').classList.add('hidden');
                document.getElementById('save-btn').classList.add('hidden');
                if (document.getElementById('mtab-guide')) document.getElementById('mtab-guide').classList.remove('hidden');
                switchModalTab('guide');
            } else {
                if (document.getElementById('date-input-container')) {
                    dateInput.valueAsDate = currentSelectedDate;
                    document.getElementById('date-input-container').classList.remove('hidden');
                    document.getElementById('save-btn').classList.remove('hidden');
                }
                if (document.getElementById('mtab-guide')) document.getElementById('mtab-guide').classList.remove('hidden');
                switchModalTab('timeline');
            }
            calculateDates();
            document.getElementById('calc-modal').classList.remove('hidden');
        }
        function closeCalcModal() { document.getElementById('calc-modal').classList.add('hidden'); }
        function openScheduleDetails(id) {
            const item = mySchedules.find(s => s.id === id);
            if (!item) return;
            const crop = allCrops.find(c => c.id === item.fruitId);
            if (crop) openCalcModal(crop, new Date(item.startDate));
        }
        function switchModalTab(tab) {
            const timeline = document.getElementById('modal-content-timeline');
            const guide = document.getElementById('modal-content-guide');
            const btnT = document.getElementById('mtab-timeline');
            const btnG = document.getElementById('mtab-guide');
            if(tab === 'timeline') {
                timeline.classList.remove('hidden'); guide.classList.add('hidden');
                btnT.className = 'flex-1 py-3 text-sm font-medium modal-tab-active';
                btnG.className = 'flex-1 py-3 text-sm font-medium modal-tab-inactive';
            } else {
                guide.classList.remove('hidden'); timeline.classList.add('hidden');
                btnG.className = 'flex-1 py-3 text-sm font-medium modal-tab-active';
                btnT.className = 'flex-1 py-3 text-sm font-medium modal-tab-inactive';
            }
        }
        function calculateDates() {
            if(!currentPlanting) return;
            const start = new Date(document.getElementById('start-date').value);
            const fert = new Date(start); fert.setDate(start.getDate() + currentPlanting.fertilizeDays);
            const harv = new Date(start); harv.setDate(start.getDate() + currentPlanting.harvestDays);
            document.getElementById('preview-start-date').innerText = formatDate(start);
            document.getElementById('preview-fertilize-date').innerText = formatDate(fertilizeDays(start, currentPlanting.fertilizeDays));
            document.getElementById('preview-harvest-date').innerText = formatDate(harvestDays(start, currentPlanting.harvestDays));
            
            function fertilizeDays(d, days) { const r = new Date(d); r.setDate(r.getDate() + days); return r; }
            function harvestDays(d, days) { const r = new Date(d); r.setDate(r.getDate() + days); return r; }
        }
        function saveSchedule() {
            if(!currentPlanting) return;
            const start = new Date(document.getElementById('start-date').value);
            const fert = new Date(start); fert.setDate(start.getDate() + currentPlanting.fertilizeDays);
            const harv = new Date(start); harv.setDate(start.getDate() + currentPlanting.harvestDays);
            const newItem = {
                id: Date.now(),
                fruitId: currentPlanting.id,
                name: currentPlanting.name,
                icon: currentPlanting.icon,
                startDate: start.toISOString(),
                fertilizeDate: fert.toISOString(),
                harvestDate: harv.toISOString(),
                image: "" 
            };
            mySchedules.unshift(newItem); 
            try {
                localStorage.setItem('myPlantingSchedule', JSON.stringify(mySchedules));
                closeCalcModal();
                renderScheduleList();
                toggleView('schedule'); 
            } catch (err) {
                alert("‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏ï‡πá‡∏° ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ");
            }
        }
        function openMarketModal() {
            document.getElementById('market-modal').classList.remove('hidden');
            renderMarketTable(false);
        }
        function closeMarketModal() { document.getElementById('market-modal').classList.add('hidden'); }
        function switchMarketTab(type) { currentMarketCategory = type; renderMarketTable(false); }
        async function updateMarketData() {
            document.getElementById('loading-indicator').classList.remove('hidden');
            try {
                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'get_prices', date: currentSelectedDate.toISOString() })
                });
                if (!response.ok) throw new Error("API Error");
            } catch(e) {
                console.log("Using simulation");
                await new Promise(r => setTimeout(r, 1000));
            }
            renderMarketTable(true);
            const time = new Date().toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'});
            document.getElementById('market-last-update').innerText = "‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ " + time;
            document.getElementById('loading-indicator').classList.add('hidden');
        }
        function renderMarketTable(random) {
            const tbody = document.getElementById('market-tbody');
            tbody.innerHTML = '';
            const list = allCrops.filter(c => c.type === currentMarketCategory);
            list.forEach(c => {
                let p1 = c.seedBase, p2 = c.saplingBase;
                if(random) { p1 = Math.round(p1 * (0.8 + Math.random()*0.4)); p2 = Math.round(p2 * (0.8 + Math.random()*0.4)); }
                tbody.innerHTML += `<tr><td><div class="flex items-center gap-2"><span class="text-lg">${c.icon}</span><span>${c.name}</span></div></td><td>${p1}</td><td>${p2}</td><td class="text-center"><i class="fa-solid fa-minus text-gray-300"></i></td></tr>`;
            });
            document.getElementById('market-table-content').classList.remove('hidden');
        }
        function openCalculator() { document.getElementById('calculator-modal').classList.remove('hidden'); }
        function closeCalculator() { document.getElementById('calculator-modal').classList.add('hidden'); }
        function calcAppend(v) { document.getElementById('calc-display').value += v; }
        function calcClear() { document.getElementById('calc-display').value = ''; }
        function calcEqual() { try { document.getElementById('calc-display').value = eval(document.getElementById('calc-display').value); } catch{ document.getElementById('calc-display').value = 'Error'; } }
        function toggleChat() {
            const chat = document.getElementById('chatbot-window');
            if(chat.classList.contains('hidden')) {
                chat.classList.remove('hidden');
                setTimeout(() => chat.classList.remove('translate-y-full'), 10);
            } else {
                chat.classList.add('translate-y-full');
                setTimeout(() => chat.classList.add('hidden'), 300);
            }
        }
        function handleChatEnter(e) { if(e.key === 'Enter') sendChatMessage(); }
        async function sendChatMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;
            appendMessage(text, true);
            input.value = '';
            showTypingIndicator();
            let reply = "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢";
            try {
                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'chat', message: text })
                });
                if (response.ok) {
                    const data = await response.json();
                    reply = data.reply || "‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö";
                } else {
                     throw new Error("Backend non-200");
                }
            } catch (error) {
                await new Promise(r => setTimeout(r, 1000));
                if (text.includes('‡∏£‡∏≤‡∏Ñ‡∏≤')) reply = "‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏ï‡∏•‡∏≤‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏£‡∏±‡∏ö ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏•‡∏≤‡∏î‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡πÑ‡∏°‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ñ‡∏£‡∏±‡∏ö";
                else if (text.includes('‡∏õ‡∏•‡∏π‡∏Å')) reply = "‡∏Å‡∏≤‡∏£‡∏õ‡∏•‡∏π‡∏Å‡∏û‡∏∑‡∏ä‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡∏°‡∏µ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏ô‡πÉ‡∏à‡∏û‡∏∑‡∏ä‡∏ä‡∏ô‡∏¥‡∏î‡πÑ‡∏´‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÑ‡∏´‡∏°‡∏Ñ‡∏£‡∏±‡∏ö?";
                else reply = "‡∏ú‡∏°‡πÄ‡∏õ‡πá‡∏ô AI ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏Å‡∏©‡∏ï‡∏£ ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö";
            }
            removeTypingIndicator();
            appendMessage(reply, false);
        }
        function appendMessage(text, isUser) {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = `chat-msg ${isUser ? 'chat-user' : 'chat-bot'} animate-pop`;
            div.innerHTML = text;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }
        function showTypingIndicator() {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.id = 'typing-indicator';
            div.className = `chat-msg chat-bot`;
            div.innerHTML = `<span class="typing-dot"></span><span class="typing-dot"></span><span class="typing-dot"></span>`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }
        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) indicator.remove();
        }
        document.addEventListener('DOMContentLoaded', () => {
            const picker = document.getElementById('global-date-picker');
            if (picker) {
                picker.valueAsDate = currentSelectedDate;
                picker.addEventListener('change', (e) => {
                    currentSelectedDate = new Date(e.target.value);
                    currentMonthIndex = currentSelectedDate.getMonth();
                    updateHeaderAndSeason();
                });
            }
            updateHeaderAndSeason();
            renderCrops();
            renderScheduleList();
            const startDateInput = document.getElementById('start-date');
            if (startDateInput) {
                startDateInput.valueAsDate = new Date();
                startDateInput.addEventListener('change', calculateDates);
            }
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    renderCrops(); 
                });
            }
        });
    </script>
</body>
</html>
